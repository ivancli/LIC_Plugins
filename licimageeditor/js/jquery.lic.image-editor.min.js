"use strict";(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){var t={main_container:null,header_text:null,btn_close:null,backdrop_container:null,header_container:null,toolbar_container:null,ondraw_image:null,actual_image:null,box_width:0,box_height:0,box_margin_left:0,box_margin_top:0,advance_option_container:null,advance_option_backdrop_container:null,selected_tool:null,btn_pencil:null,btn_eraser:null,btn_line:null,btn_arrow:null,btn_square:null,btn_circle:null,btn_text:null,btn_eyedropper:null,btn_color:null,range_thickness:null,btn_load_image:null,btn_save_image:null,btn_flip_v:null,btn_flip_h:null,btn_desaturate:null,btn_brightness:null,btn_contrast:null,btn_hue:null,btn_blur:null,btn_unsharp_mask:null,btn_posterise:null,btn_invert:null,btn_sepia_tone:null,btn_edge_detect:null,btn_noise:null,btn_solarise:null,btn_glow:null,file_input:null,jav_ondraw_canvas:null,jav_actual_canvas:null,jav_ondraw_context:null,jav_actual_context:null,ondraw_required_tools:["line","arrow","square","circle","text"],is_mouse_down:false,mouse_down_x:null,mouse_down_y:null,animation:true,animation_velocity:500,auto_show:true,backdrop:true,title:null,show_close_button:true,show_paint_tools:true,show_adjust_tools:true,show_effect_tools:true,canvas_width:500,canvas_height:500,image_source:null,on_save:null,backdrop_html:"<div class='lic_imageeditor-backdrop'></div>",close_button_html:"<span class='btn-close'></span>",header_html:"<div class='header'><span class='title'></span></div>",toolbar_html:"<section class='tool-container'></section>",paint_tool_html:"<div class='tool-paint'><input id='ac-paint' name='ac-tools' type='radio' checked><label for='ac-paint'>Paint Tools</label>"+"<article class='ac-content'>"+"<div>"+"<table>"+"<tr><td>"+"<span title='Click to load image from computer' class='btn-load-image'></span>"+"<input type='file' id='input-image' accept='image/*'>"+"</td>"+"<td><span title='Click to save image' class='btn-save-image'></span></td></tr>"+"<tr><td><span title='Pencil' class='btn-pencil'></span></td>"+"<td><span title='Eraser' class='btn-eraser'></span></td></tr>"+"<tr><td><span title='Line' class='btn-line'></span></td>"+"<td><span title='Arrow' class='btn-arrow'></span></td></tr>"+"<tr><td><span title='Square' class='btn-square'></span></td>"+"<td><span title='Circle' class='btn-circle'></span></td></tr>"+"<tr><td><span title='Text' class='btn-text'></span></td>"+"<td><span title='Eyedropper' class='btn-eyedropper'></span></td></tr>"+"</table>"+"<img src='img/icons/icon-color.png' width='80' height='80' class='btn-color'>"+"<input class='range-line-thickness' type='range' max='15' min='1' value='1'>"+"</div>"+"</article>"+"</div>",adjust_tool_html:"<div class='tool-adjust'><input id='ac-adjust' name='ac-tools' type='radio'><label for='ac-adjust'>Adjust Tools</label>"+"<article class='ac-content'>"+"<div>"+"<a class='btn-flip-v'><span class='tool-icon'></span><span class='tool-text-wrapper'>Flip Vertical</span></a>"+"<a class='btn-flip-h'><span class='tool-icon'></span><span class='tool-text-wrapper'>Flip Horizontal</span></a>"+"<a class='btn-desaturate'><span class='tool-icon'></span><span class='tool-text-wrapper'>Desaturate</span></a> "+"<a class='btn-brightness'><span class='tool-icon'></span><span class='tool-text-wrapper'>Brightness</span></a> "+"<a class='btn-contrast'><span class='tool-icon'></span><span class='tool-text-wrapper'>Contrast</span></a> "+"<a class='btn-hue'><span class='tool-icon'></span><span class='tool-text-wrapper'>Hue</span></a> "+"</div>"+"</article>"+"</div>",effect_tool_html:"<div class='tool-effect'><input id='ac-effect' name='ac-tools' type='radio'><label for='ac-effect'>Effect Tools</label>"+"<article class='ac-content'>"+"<div>"+"<a class='btn-blur'><span class='tool-icon'></span><span class='tool-text-wrapper'>Blur</span></a>"+"<a class='btn-unsharp-mask'><span class='tool-icon'></span><span class='tool-text-wrapper'>Unsharp Mask</span></a>"+"<a class='btn-posterise'><span class='tool-icon'></span><span class='tool-text-wrapper'>Posterise</span></a>"+"<a class='btn-invert'><span class='tool-icon'></span><span class='tool-text-wrapper'>Invert</span></a>"+"<a class='btn-sepia-tone'><span class='tool-icon'></span><span class='tool-text-wrapper'>Sepia Tone</span></a>"+"<a class='btn-edge-detect'><span class='tool-icon'></span><span class='tool-text-wrapper'>Edge Detect</span></a>"+"<a class='btn-noise'><span class='tool-icon'></span><span class='tool-text-wrapper'>Noise</span></a>"+"<a class='btn-solarise'><span class='tool-icon'></span><span class='tool-text-wrapper'>Solarise</span></a>"+"<a class='btn-glow'><span class='tool-icon'></span><span class='tool-text-wrapper'>Glow</span></a>"+"</div>"+"</article>"+"</div>",canvas_html:"<div class='canvas-container'><canvas class='ondraw-image'></canvas><canvas class='actual-image'></canvas></div>",advance_option_html:"<div class='advance-option-box'><div class='advance-option-footer'>"+"<span id='btn-ok'>OK</span>"+"<span id='btn-cancel'>Cancel</span>"+"</div></div>",advance_option_backdrop_html:"<div class='lic_imageeditor-advance-option-backdrop'></div>",text_html:"<div class='text-option'>"+"<table>"+"<tr><td><label for='range-size'>Text Size</label></td>"+"<td><input type='range' max='40' min='8' id='range-size' value='10'></td></tr>"+"<tr><td><label for='txt-text'>Content</label></td>"+"<td><input type='text' id='txt-text'></td></tr>"+"</table>"+"</div>",brightness_html:"<div class='brightness-option'>"+"<table>"+"<tr><td><label for='range-brightness'>Brightness</label></td>"+"<td><input type='range' id='range-brightness' max='150' min='-150' value='0'></td></tr>"+"</table>"+"</div>",contrast_html:"<div class='contrast-option'>"+"<table>"+"<tr><td><label for='range-contrast'>Contrast</label></td>"+"<td><input type='range' id='range-contrast' max='3' min='-1' step='0.1' value='0'></td></tr>"+"</table>"+"</div>",hue_html:"<div class='hue-option'>"+"<table>"+"<tr><td><label for='range-hue'>Hue</label></td>"+"<td><input type='range' id='range-hue' max='180' min='-180' value='0'></td></tr>"+"</table>"+"</div>",unsharp_mask_html:"<div class='unsharp-mask-option'>"+"<table>"+"<tr><td><label for='range-amount'>Amount</label></td>"+"<td><input type='range' id='range-amount' max='500' min='0' value='0'></td></tr>"+"<tr><td><label for='range-radius'>Radius</label></td>"+"<td><input type='range' id='range-radius' max='5' min='0' value='0' step='0.05'></td></tr>"+"<tr><td><label for='range-threshold'>Threshold</label></td>"+"<td><input type='range' id='range-threshold' max='255' min='0' value='0'></td></tr>"+"</table>"+"</div>",posterise_html:"<div class='posterise-option'>"+"<table>"+"<tr><td><label for='range-level'>Level</label></td>"+"<td><input type='range' id='range-level' max='32' min='1' value='32'></td></tr>"+"</table>"+"</div>",noise_html:"<div class='noise-option'>"+"<table>"+"<tr><td><label for='range-amount'>Amount</label></td>"+"<td><input type='range' id='range-amount' max='1' min='0' value='0' step='0.01'></td></tr>"+"<tr><td><label for='range-strength'>Strength</label></td>"+"<td><input type='range' id='range-strength' max='1' min='0' value='0' step='0.01'></td></tr>"+"<tr><td><label for='range-monochromatic'>Monochromatic</label></td>"+"<td><input type='checkbox' id='chk-monochromatic'></td></tr>"+"</table>"+"</div>",glow_html:"<div class='glow-option'>"+"<table>"+"<tr><td><label for='range-amount'>Amount</label></td>"+"<td><input type='range' id='range-amount' max='1' min='0' value='0' step='0.01'></td></tr>"+"<tr><td><label for='range-radius'>Radius</label></td>"+"<td><input type='range' id='range-radius' max='1' min='0' value='0' step='0.01'></td></tr>"+"</table>"+"</div>"};e.fn.lic_imageeditor=function(n,r){return this.each(function(){var i=e.extend(true,{},t);var s=e(this);if(typeof n==="object"){e.extend(true,i,n)}else{r=n}i.main_container=s;var o=function(){if(i.backdrop){e("body").append(i.backdrop_html);i.backdrop_container=e("body").find(".lic_imageeditor-backdrop")}if(!i.main_container.hasClass("lic_imageeditor-box")){i.main_container.addClass("lic_imageeditor-box")}if(i.title||i.show_close_button){i.main_container.append(i.header_html);i.header_container=i.main_container.find(".header");if(i.title){i.header_text=i.header_container.find(".title");i.header_text.html(i.title)}if(i.show_close_button){i.header_container.append(i.close_button_html);i.btn_close=i.header_container.find(".btn-close");i.btn_close.click(function(){p()})}}if(i.show_paint_tools||i.show_adjust_tools||i.show_effect_tools){i.main_container.append(i.toolbar_html);i.toolbar_container=i.main_container.find(".tool-container")}if(i.show_paint_tools){i.toolbar_container.append(i.paint_tool_html)}if(i.show_adjust_tools){i.toolbar_container.append(i.adjust_tool_html)}if(i.show_effect_tools){i.toolbar_container.append(i.effect_tool_html)}i.main_container.append(i.canvas_html);i.ondraw_image=i.main_container.find(".ondraw-image");i.actual_image=i.main_container.find(".actual-image");i.ondraw_image.attr({width:i.canvas_width,height:i.canvas_height});i.actual_image.attr({width:i.canvas_width,height:i.canvas_height});i.box_height+=i.header_container.height();if(i.toolbar_container.height()>i.ondraw_image.height()){i.box_height+=i.toolbar_container.height()+20}else{i.box_height+=i.ondraw_image.height()+20}i.box_width+=i.toolbar_container.width()+10;i.box_width+=i.ondraw_image.width()+20;i.box_margin_left=-i.box_width/2;i.box_margin_top=-i.box_height/2;i.main_container.css({width:i.box_width,height:i.box_height,"margin-left":i.box_margin_left,"margin-top":i.box_margin_top});s.data("lic_image-editor",s);s.data("lic_image-editor-show",h);s.data("lic_image-editor-hide",p);s.data("lic_image-editor-toggle",d);if(!i.auto_show){i.main_container.hide();i.backdrop_container.hide()}if(i.image_source){a(i.image_source)}u()};var u=function(){i.btn_load_image=i.toolbar_container.find(".btn-load-image");i.btn_save_image=i.toolbar_container.find(".btn-save-image");i.btn_pencil=i.toolbar_container.find(".btn-pencil");i.btn_eraser=i.toolbar_container.find(".btn-eraser");i.btn_line=i.toolbar_container.find(".btn-line");i.btn_arrow=i.toolbar_container.find(".btn-arrow");i.btn_square=i.toolbar_container.find(".btn-square");i.btn_circle=i.toolbar_container.find(".btn-circle");i.btn_text=i.toolbar_container.find(".btn-text");i.btn_eyedropper=i.toolbar_container.find(".btn-eyedropper");i.btn_color=i.toolbar_container.find(".btn-color");i.range_thickness=i.toolbar_container.find(".range-line-thickness");i.btn_flip_v=i.toolbar_container.find(".btn-flip-v");i.btn_flip_h=i.toolbar_container.find(".btn-flip-h");i.btn_desaturate=i.toolbar_container.find(".btn-desaturate");i.btn_brightness=i.toolbar_container.find(".btn-brightness");i.btn_contrast=i.toolbar_container.find(".btn-contrast");i.btn_hue=i.toolbar_container.find(".btn-hue");i.btn_blur=i.toolbar_container.find(".btn-blur");i.btn_unsharp_mask=i.toolbar_container.find(".btn-unsharp-mask");i.btn_posterise=i.toolbar_container.find(".btn-posterise");i.btn_invert=i.toolbar_container.find(".btn-invert");i.btn_sepia_tone=i.toolbar_container.find(".btn-sepia-tone");i.btn_edge_detect=i.toolbar_container.find(".btn-edge-detect");i.btn_noise=i.toolbar_container.find(".btn-noise");i.btn_solarise=i.toolbar_container.find(".btn-solarise");i.btn_glow=i.toolbar_container.find(".btn-glow");i.file_input=i.toolbar_container.find("#input-image");i.ondraw_image=i.main_container.find(".ondraw-image");i.actual_image=i.main_container.find(".actual-image");i.jav_actual_canvas=i.actual_image.get(0);i.jav_ondraw_canvas=i.ondraw_image.get(0);i.jav_actual_context=i.jav_actual_canvas.getContext("2d");i.jav_ondraw_context=i.jav_ondraw_canvas.getContext("2d");i.btn_load_image.click(function(){i.file_input.trigger("click")});i.file_input.change(function(){var e=new FileReader;e.onload=function(){a(e.result)};e.readAsDataURL(this.files[0])});i.btn_save_image.click(function(){if(e.isFunction(i.on_save)){i.on_save(i.jav_actual_canvas.toDataURL("image/png"))}else{f()}});i.btn_pencil.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="pencil"});i.btn_eraser.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="eraser"});i.btn_line.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="line"});i.btn_arrow.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="arrow"});i.btn_square.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="square"});i.btn_circle.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="circle"});i.btn_text.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="text"});i.btn_eyedropper.click(function(){g();e(this).addClass("selected-tool");i.selected_tool="eyedropper"});i.btn_color.ColorPicker({color:i.btn_color.css("background-color"),onShow:function(t){if(i.animation){e(t).fadeIn(i.animation_velocity)}return false},onHide:function(t){if(i.animation){e(t).fadeOut(i.animation_velocity)}return false},onChange:function(e,t,n){i.btn_color.css("background-color","#"+t)}});i.btn_flip_v.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"flipv");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_flip_h.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"fliph");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_desaturate.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"desaturate",{average:false});i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_brightness.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.brightness_html);i.advance_option_container.find("#range-brightness").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"brightness",{brightness:i.advance_option_container.find("#range-brightness").val(),contrast:0});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_contrast.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.contrast_html);i.advance_option_container.find("#range-contrast").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"brightness",{brightness:0,contrast:i.advance_option_container.find("#range-contrast").val()});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_hue.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.hue_html);i.advance_option_container.find("#range-hue").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"hsl",{hue:i.advance_option_container.find("#range-hue").val(),saturation:0,lightness:0});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_blur.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"blur");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_unsharp_mask.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.unsharp_mask_html);i.advance_option_container.find("#range-amount, #range-radius, #range-threshold").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"unsharpmask",{amount:i.advance_option_container.find("#range-amount").val(),radius:i.advance_option_container.find("#range-radius").val(),threshold:i.advance_option_container.find("#range-threshold").val()});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_posterise.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.posterise_html);i.advance_option_container.find("#range-level").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"posterize",{levels:i.advance_option_container.find("#range-level").val()});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_invert.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"invert");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_sepia_tone.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"sepia");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_edge_detect.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"edges2");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_noise.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.noise_html);i.advance_option_container.find("#range-amount, #range-strength, #chk-monochromatic").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"noise",{mono:i.advance_option_container.find("#chk-monochromatic").is(":checked"),amount:i.advance_option_container.find("#range-amount").val(),strength:i.advance_option_container.find("#range-strength").val()});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});i.btn_solarise.click(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"solarize");i.jav_actual_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")});i.btn_glow.click(function(e){l(e.clientX,e.clientY);i.advance_option_container.prepend(i.glow_html);i.advance_option_container.find("#range-amount, #range-radius").mouseup(function(){var e=new Image;e.onload=function(){e=Pixastic.process(e,"glow",{amount:i.advance_option_container.find("#range-amount").val(),radius:i.advance_option_container.find("#range-radius").val()});i.jav_ondraw_context.drawImage(e,0,0)};e.src=i.jav_actual_canvas.toDataURL("image/png")})});e("body").mousedown(function(e){i.is_mouse_down=true;i.mouse_down_x=e.pageX-i.actual_image.offset().left;i.mouse_down_y=e.pageY-i.actual_image.offset().top});e("body").mouseup(function(){i.is_mouse_down=false;if(e.inArray(i.selected_tool,i.ondraw_required_tools)!=-1){i.jav_actual_context.drawImage(i.jav_ondraw_canvas,0,0);i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height)}});i.ondraw_image.mousemove(function(e){if(i.selected_tool&&i.is_mouse_down){switch(i.selected_tool){case"pencil":y(e.pageX,e.pageY);break;case"eraser":b(e.pageX,e.pageY);break;case"line":w(e.pageX,e.pageY);break;case"arrow":E(e.pageX,e.pageY);break;case"square":S(e.pageX,e.pageY);console.log("square");break;case"circle":x(e.pageX,e.pageY);break;case"eyedropper":N(e.pageX,e.pageY);break}}});i.ondraw_image.click(function(t){if(i.selected_tool=="text"){var n=t.pageX-i.ondraw_image.offset().left;var r=t.pageY-i.ondraw_image.offset().top;l(i.btn_text.offset().left,i.btn_text.offset().top);i.advance_option_container.prepend(i.text_html);i.advance_option_container.find("#range-size").change(function(){T(i.advance_option_container.find("#txt-text").val(),e(this).val(),n,r)});i.advance_option_container.find("#txt-text").keyup(function(){T(e(this).val(),i.advance_option_container.find("#range-size").val(),n,r)})}})};var a=function(e){var t=new Image;t.onload=function(){if(t.width>t.height){var e=i.canvas_width/t.width;t.width=i.canvas_width;t.height*=e}else{var e=i.canvas_height/t.height;t.height=i.canvas_height;t.width*=e}i.jav_actual_canvas.width=t.width;i.jav_actual_canvas.height=t.height;i.jav_ondraw_canvas.width=t.width;i.jav_ondraw_canvas.height=t.height;i.jav_actual_context.drawImage(t,0,0,i.jav_actual_canvas.width,i.jav_actual_canvas.height)};t.src=e};var f=function(){var t=i.jav_actual_canvas.toDataURL("image/png");if(i.title){var n=i.title}else{var n="image.png"}e("body").append("<a id='lic_image-editor-download' href='"+t+"' download='"+n+"'></a>");e("#lic_image-editor-download").get(0).click();e("#lic_image-editor-download").remove()};var l=function(t,n){g();e("body").append(i.advance_option_html);i.advance_option_container=e("body").find(".advance-option-box");e("body").append(i.advance_option_backdrop_html);i.advance_option_backdrop_container=e("body").find(".lic_imageeditor-advance-option-backdrop");i.advance_option_backdrop_container.click(function(){c()});i.advance_option_container.css({left:t+"px",top:n+"px"});i.advance_option_container.find("#btn-ok").click(function(){i.jav_actual_context.drawImage(i.jav_ondraw_canvas,0,0);c()});i.advance_option_container.find("#btn-cancel").click(function(){c()})};var c=function(){i.advance_option_container.remove();i.advance_option_backdrop_container.remove();i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height)};var h=function(){if(i.backdrop){v()}else{m()}if(i.animation){i.main_container.fadeIn(i.animation_velocity)}else{i.main_container.show()}};var p=function(){if(i.animation){i.main_container.fadeOut(i.animation_velocity)}else{i.main_container.hide()}m()};var d=function(){if(s.is(":visible")){p()}else{h()}};var v=function(){e("body").append(i.backdrop_html);i.backdrop_container=e("body").find(".lic_imageeditor-backdrop");if(i.animation){i.backdrop_container.fadeIn(i.animation_velocity)}else{i.backdrop_container.show()}};var m=function(){if(i.animation){i.backdrop_container.fadeOut(i.animation_velocity,function(){e(this).remove()})}else{i.backdrop_container.remove()}};var g=function(){i.toolbar_container.find(".tool-paint article span").each(function(){e(this).removeClass("selected-tool")});i.selected_tool=null};var y=function(e,t){var n=e-i.actual_image.offset().left;var r=t-i.actual_image.offset().top;var s=n,o=i.mouse_down_x,u=r,a=i.mouse_down_y;var f=Math.abs(a-u)>Math.abs(o-s);if(f){s=[u,u=s][0];o=[a,a=o][0]}if(s>o){s=[o,o=s][0];u=[a,a=u][0]}var l=o-s,c=Math.abs(a-u),h=0,p=c/l,d=-1,v=u;if(u<a){d=1}i.jav_actual_context.fillStyle=i.btn_color.css("background-color");for(var m=s;m<o;m++){if(f){i.jav_actual_context.fillRect(v,m,i.range_thickness.val(),i.range_thickness.val())}else{i.jav_actual_context.fillRect(m,v,i.range_thickness.val(),i.range_thickness.val())}h+=p;if(h>=.5){v+=d;h-=1}}i.mouse_down_x=n;i.mouse_down_y=r};var b=function(e,t){var n=e-i.actual_image.offset().left;var r=t-i.actual_image.offset().top;var s=n,o=i.mouse_down_x,u=r,a=i.mouse_down_y;var f=Math.abs(a-u)>Math.abs(o-s);if(f){s=[u,u=s][0];o=[a,a=o][0]}if(s>o){s=[o,o=s][0];u=[a,a=u][0]}var l=o-s,c=Math.abs(a-u),h=0,p=c/l,d=-1,v=u;if(u<a){d=1}for(var m=s;m<o;m++){if(f){i.jav_actual_context.clearRect(v,m,i.range_thickness.val(),i.range_thickness.val())}else{i.jav_actual_context.clearRect(m,v,i.range_thickness.val(),i.range_thickness.val())}h+=p;if(h>=.5){v+=d;h-=1}}i.mouse_down_x=n;i.mouse_down_y=r};var w=function(e,t){i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height);i.jav_ondraw_context.lineCap="round";i.jav_ondraw_context.strokeStyle=i.btn_color.css("background-color");i.jav_ondraw_context.lineWidth=i.range_thickness.val();i.jav_ondraw_context.beginPath();i.jav_ondraw_context.moveTo(i.mouse_down_x,i.mouse_down_y);i.jav_ondraw_context.lineTo(e-i.ondraw_image.offset().left,t-i.ondraw_image.offset().top);i.jav_ondraw_context.stroke();i.jav_ondraw_context.closePath()};var E=function(e,t){i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height);i.jav_ondraw_context.lineCap="round";i.jav_ondraw_context.strokeStyle=i.btn_color.css("background-color");i.jav_ondraw_context.fillStyle=i.btn_color.css("background-color");i.jav_ondraw_context.lineWidth=i.range_thickness.val();i.jav_ondraw_context.beginPath();i.jav_ondraw_context.moveTo(i.mouse_down_x,i.mouse_down_y);var n=e-i.ondraw_image.offset().left;var r=t-i.ondraw_image.offset().top;i.jav_ondraw_context.lineTo(n,r);i.jav_ondraw_context.stroke();i.jav_ondraw_context.closePath();var s=n-i.mouse_down_x;var o=r-i.mouse_down_y;var u=Math.sqrt(s*s+o*o);var a=s/u;var f=o/u;var l=5;var c=n-a*l-f*l;var h=r-f*l+a*l;var p=n-a*l+f*l;var d=r-f*l-a*l;i.jav_ondraw_context.beginPath();i.jav_ondraw_context.moveTo(n,r);i.jav_ondraw_context.lineTo(c,h);i.jav_ondraw_context.lineTo(p,d);i.jav_ondraw_context.lineTo(n,r);i.jav_ondraw_context.fill();i.jav_ondraw_context.stroke();i.jav_ondraw_context.closePath()};var S=function(e,t){i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height);i.jav_ondraw_context.lineWidth=i.range_thickness.val();i.jav_ondraw_context.lineCap="round";i.jav_ondraw_context.strokeStyle=i.btn_color.css("background-color");i.jav_ondraw_context.beginPath();i.jav_ondraw_context.rect(i.mouse_down_x,i.mouse_down_y,e-i.ondraw_image.offset().left-i.mouse_down_x,t-i.ondraw_image.offset().top-i.mouse_down_y);i.jav_ondraw_context.stroke();i.jav_ondraw_context.closePath()};var x=function(e,t){i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height);i.jav_ondraw_context.lineWidth=i.range_thickness.val();i.jav_ondraw_context.strokeStyle=i.btn_color.css("background-color");i.jav_ondraw_context.beginPath();var n=e-i.ondraw_image.offset().left-i.mouse_down_x;var r=t-i.ondraw_image.offset().top-i.mouse_down_y;var s=.5522848,o=n/2*s,u=r/2*s,a=i.mouse_down_x+n,f=i.mouse_down_y+r,l=i.mouse_down_x+n/2,c=i.mouse_down_y+r/2;i.jav_ondraw_context.beginPath();i.jav_ondraw_context.moveTo(i.mouse_down_x,c);i.jav_ondraw_context.bezierCurveTo(i.mouse_down_x,c-u,l-o,i.mouse_down_y,l,i.mouse_down_y);i.jav_ondraw_context.bezierCurveTo(l+o,i.mouse_down_y,a,c-u,a,c);i.jav_ondraw_context.bezierCurveTo(a,c+u,l+o,f,l,f);i.jav_ondraw_context.bezierCurveTo(l-o,f,i.mouse_down_x,c+u,i.mouse_down_x,c);i.jav_ondraw_context.stroke();i.jav_ondraw_context.closePath()};var T=function(e,t,n,r){i.jav_ondraw_context.clearRect(0,0,i.canvas_width,i.canvas_height);i.jav_ondraw_context.font=t+"px Arial";i.jav_ondraw_context.fillStyle=i.btn_color.css("background-color");i.jav_ondraw_context.fillText(e,n,r)};var N=function(e,t){var n=i.jav_actual_context.getImageData(e-i.actual_image.offset().left,t-i.actual_image.offset().top,1,1);var r=n.data;var s=r[0];var o=r[1];var u=r[2];i.btn_color.css("background","rgb("+s+","+o+","+u+")")};if(r==="show"){if(s.data("lic_image-editor-show")&&!s.is(":visible")){s.data("lic_image-editor-show")()}return s}else if(r==="hide"){if(s.data("lic_image-editor-hide")&&s.is(":visible")){s.data("lic_image-editor-hide")()}return s}else if(r==="toggle"){if(s.data("lic_image-editor-toggle")){s.data("lic_image-editor-toggle")()}return s}if(s.data("lic_image-editor")){return s.data("lic_image-editor")}o()})}});(function(e){var t=function(){var t={},n,r=65,i,s='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},u=function(t,n){var r=q(t);e(n).data("colorpicker").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,n){e(n).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},f=function(t,n){e(n).data("colorpicker").fields.eq(0).val(U(t)).end()},l=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor","#"+U({h:t.h,s:100,b:100}));e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},h=function(t,n){e(n).data("colorpicker").currentColor.css("backgroundColor","#"+U(t))},p=function(t,n){e(n).data("colorpicker").newColor.css("backgroundColor","#"+U(t))},d=function(t){var n=t.charCode||t.keyCode||-1;if(n>r&&n<=90||n==32){return false}var i=e(this).parent().parent();if(i.data("colorpicker").livePreview===true){v.apply(this)}},v=function(t){var n=e(this).parent().parent(),r;if(this.parentNode.className.indexOf("_hex")>0){n.data("colorpicker").color=r=F(B(this.value))}else if(this.parentNode.className.indexOf("_hsb")>0){n.data("colorpicker").color=r=P({h:parseInt(n.data("colorpicker").fields.eq(4).val(),10),s:parseInt(n.data("colorpicker").fields.eq(5).val(),10),b:parseInt(n.data("colorpicker").fields.eq(6).val(),10)})}else{n.data("colorpicker").color=r=I(H({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10)}))}if(t){u(r,n.get(0));f(r,n.get(0));a(r,n.get(0))}l(r,n.get(0));c(r,n.get(0));p(r,n.get(0));n.data("colorpicker").onChange.apply(n,[r,U(r),q(r)])},m=function(t){var n=e(this).parent().parent();n.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},g=function(){r=this.parentNode.className.indexOf("_hex")>0?70:65;e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");e(this).parent().addClass("colorpicker_focus")},y=function(t){var n=e(this).parent().find("input").focus();var r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",r,w);e(document).bind("mousemove",r,b)},b=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10))));if(e.data.preview){v.apply(e.data.field.get(0),[true])}return false},w=function(t){v.apply(t.data.field.get(0),[true]);t.data.el.removeClass("colorpicker_slider").find("input").focus();e(document).unbind("mouseup",w);e(document).unbind("mousemove",b);return false},E=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,x);e(document).bind("mousemove",n,S)},S=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]);return false},x=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",x);e(document).unbind("mousemove",S);return false},T=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,C);e(document).bind("mousemove",n,N)},N=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]);return false},C=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",C);e(document).unbind("mousemove",N);return false},k=function(t){e(this).addClass("colorpicker_focus")},L=function(t){e(this).removeClass("colorpicker_focus")},A=function(t){var n=e(this).parent();var r=n.data("colorpicker").color;n.data("colorpicker").origColor=r;h(r,n.get(0));n.data("colorpicker").onSubmit(r,U(r),q(r),n.data("colorpicker").el)},O=function(t){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset();var i=D();var s=r.top+this.offsetHeight;var o=r.left;if(s+176>i.t+i.h){s-=this.offsetHeight+176}if(o+356>i.l+i.w){o-=356}n.css({left:o+"px",top:s+"px"});if(n.data("colorpicker").onShow.apply(this,[n.get(0)])!=false){n.show()}e(document).bind("mousedown",{cal:n},M);return false},M=function(t){if(!_(t.data.cal.get(0),t.target,t.data.cal.get(0))){if(t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])!=false){t.data.cal.hide()}e(document).unbind("mousedown",M)}},_=function(e,t,n){if(e==t){return true}if(e.contains){return e.contains(t)}if(e.compareDocumentPosition){return!!(e.compareDocumentPosition(t)&16)}var r=t.parentNode;while(r&&r!=n){if(r==e)return true;r=r.parentNode}return false},D=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},P=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},H=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},B=function(e){var t=6-e.length;if(t>0){var n=[];for(var r=0;r<t;r++){n.push("0")}n.push(e);e=n.join("")}return e},j=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},F=function(e){return I(j(e))},I=function(e){var t={h:0,s:0,b:0};var n=Math.min(e.r,e.g,e.b);var r=Math.max(e.r,e.g,e.b);var i=r-n;t.b=r;if(r!=0){}t.s=r!=0?255*i/r:0;if(t.s!=0){if(e.r==r){t.h=(e.g-e.b)/i}else if(e.g==r){t.h=2+(e.b-e.r)/i}else{t.h=4+(e.r-e.g)/i}}else{t.h=-1}t.h*=60;if(t.h<0){t.h+=360}t.s*=100/255;t.b*=100/255;return t},q=function(e){var t={};var n=Math.round(e.h);var r=Math.round(e.s*255/100);var i=Math.round(e.b*255/100);if(r==0){t.r=t.g=t.b=i}else{var s=i;var o=(255-r)*i/255;var u=(s-o)*(n%60)/60;if(n==360)n=0;if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},R=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){if(t.length==1){n[e]="0"+t}});return n.join("")},U=function(e){return R(q(e))},z=function(){var t=e(this).parent();var n=t.data("colorpicker").origColor;t.data("colorpicker").color=n;u(n,t.get(0));f(n,t.get(0));a(n,t.get(0));l(n,t.get(0));c(n,t.get(0));p(n,t.get(0))};return{init:function(t){t=e.extend({},o,t||{});if(typeof t.color=="string"){t.color=F(t.color)}else if(t.color.r!=undefined&&t.color.g!=undefined&&t.color.b!=undefined){t.color=I(t.color)}else if(t.color.h!=undefined&&t.color.s!=undefined&&t.color.b!=undefined){t.color=P(t.color)}else{return this}return this.each(function(){if(!e(this).data("colorpickerId")){var n=e.extend({},t);n.origColor=t.color;var r="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colorpickerId",r);var i=e(s).attr("id",r);if(n.flat){i.appendTo(this).show()}else{i.appendTo(document.body)}n.fields=i.find("input").bind("keyup",d).bind("change",v).bind("blur",m).bind("focus",g);i.find("span").bind("mousedown",y).end().find(">div.colorpicker_current_color").bind("click",z);n.selector=i.find("div.colorpicker_color").bind("mousedown",T);n.selectorIndic=n.selector.find("div div");n.el=this;n.hue=i.find("div.colorpicker_hue div");i.find("div.colorpicker_hue").bind("mousedown",E);n.newColor=i.find("div.colorpicker_new_color");n.currentColor=i.find("div.colorpicker_current_color");i.data("colorpicker",n);i.find("div.colorpicker_submit").bind("mouseenter",k).bind("mouseleave",L).bind("click",A);u(n.color,i.get(0));a(n.color,i.get(0));f(n.color,i.get(0));c(n.color,i.get(0));l(n.color,i.get(0));h(n.color,i.get(0));p(n.color,i.get(0));if(n.flat){i.css({position:"relative",display:"block"})}else{e(this).bind(n.eventName,O)}}})},showPicker:function(){return this.each(function(){if(e(this).data("colorpickerId")){O.apply(this)}})},hidePicker:function(){return this.each(function(){if(e(this).data("colorpickerId")){e("#"+e(this).data("colorpickerId")).hide()}})},setColor:function(t){if(typeof t=="string"){t=F(t)}else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined){t=I(t)}else if(t.h!=undefined&&t.s!=undefined&&t.b!=undefined){t=P(t)}else{return this}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t;n.data("colorpicker").origColor=t;u(t,n.get(0));a(t,n.get(0));f(t,n.get(0));c(t,n.get(0));l(t,n.get(0));h(t,n.get(0));p(t,n.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor})})(jQuery);var Pixastic=function(){function e(e,t,n){if(e.addEventListener)e.addEventListener(t,n,false);else if(e.attachEvent)e.attachEvent("on"+t,n)}function t(t){var n=false;var r=function(){if(!n){n=true;t()}};document.write("<"+'script defer src="//:" id="__onload_ie_pixastic__"></'+"script>");var i=document.getElementById("__onload_ie_pixastic__");i.onreadystatechange=function(){if(i.readyState=="complete"){i.parentNode.removeChild(i);r()}};if(document.addEventListener)document.addEventListener("DOMContentLoaded",r,false);e(window,"load",r)}function n(){var e=r("pixastic",null,"img");var t=r("pixastic",null,"canvas");var n=e.concat(t);for(var i=0;i<n.length;i++){(function(){var e=n[i];var t=[];var r=e.className.split(" ");for(var s=0;s<r.length;s++){var o=r[s];if(o.substring(0,9)=="pixastic-"){var u=o.substring(9);if(u!="")t.push(u)}}if(t.length){if(e.tagName.toLowerCase()=="img"){var a=new Image;a.src=e.src;if(a.complete){for(var f=0;f<t.length;f++){var l=Pixastic.applyAction(e,e,t[f],null);if(l)e=l}}else{a.onload=function(){for(var n=0;n<t.length;n++){var r=Pixastic.applyAction(e,e,t[n],null);if(r)e=r}}}}else{setTimeout(function(){for(var n=0;n<t.length;n++){var r=Pixastic.applyAction(e,e,t[n],null);if(r)e=r}},1)}}})()}}function r(e,t,n){var r=new Array;if(t==null)t=document;if(n==null)n="*";var i=t.getElementsByTagName(n);var s=i.length;var o=new RegExp("(^|\\s)"+e+"(\\s|$)");for(var u=0,a=0;u<s;u++){if(o.test(i[u].className)){r[a]=i[u];a++}}return r}function s(e,t){if(!Pixastic.debug)return;try{switch(t){case"warn":console.warn("Pixastic:",e);break;case"error":console.error("Pixastic:",e);break;default:console.log("Pixastic:",e)}}catch(n){}if(!i){}}if(typeof pixastic_parseonload!="undefined"&&pixastic_parseonload)t(n);var i;var o=function(){var e=document.createElement("canvas");var t=false;try{t=!!(typeof e.getContext=="function"&&e.getContext("2d"))}catch(n){}return function(){return t}}();var u=function(){var e=document.createElement("canvas");var t=false;var n;try{if(typeof e.getContext=="function"&&(n=e.getContext("2d"))){t=typeof n.getImageData=="function"}}catch(r){}return function(){return t}}();var a=function(){var e=false;var t=document.createElement("canvas");if(o()&&u()){t.width=t.height=1;var n=t.getContext("2d");n.fillStyle="rgb(255,0,0)";n.fillRect(0,0,1,1);var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");i.fillStyle="rgb(0,0,255)";i.fillRect(0,0,1,1);n.globalAlpha=.5;n.drawImage(r,0,0);var s=n.getImageData(0,0,1,1).data;e=s[2]!=255}return function(){return e}}();return{parseOnLoad:false,debug:false,applyAction:function(e,t,n,r){r=r||{};var i=e.tagName.toLowerCase()=="canvas";if(i&&Pixastic.Client.isIE()){if(Pixastic.debug)s("Tried to process a canvas element but browser is IE.");return false}var o,u;var a=false;if(Pixastic.Client.hasCanvas()){a=!!r.resultCanvas;o=r.resultCanvas||document.createElement("canvas");u=o.getContext("2d")}var f=e.offsetWidth;var l=e.offsetHeight;if(i){f=e.width;l=e.height}if(f==0||l==0){if(e.parentNode==null){var c=e.style.position;var h=e.style.left;e.style.position="absolute";e.style.left="-9999px";document.body.appendChild(e);f=e.offsetWidth;l=e.offsetHeight;document.body.removeChild(e);e.style.position=c;e.style.left=h}else{if(Pixastic.debug)s("Image has 0 width and/or height.");return}}if(n.indexOf("(")>-1){var p=n;n=p.substr(0,p.indexOf("("));var d=p.match(/\((.*?)\)/);if(d[1]){d=d[1].split(";");for(var v=0;v<d.length;v++){var m=d[v].split("=");if(m.length==2){if(m[0]=="rect"){var g=m[1].split(",");r[m[0]]={left:parseInt(g[0],10)||0,top:parseInt(g[1],10)||0,width:parseInt(g[2],10)||0,height:parseInt(g[3],10)||0}}else{r[m[0]]=m[1]}}}}}if(!r.rect){r.rect={left:0,top:0,width:f,height:l}}else{r.rect.left=Math.round(r.rect.left);r.rect.top=Math.round(r.rect.top);r.rect.width=Math.round(r.rect.width);r.rect.height=Math.round(r.rect.height)}var y=false;if(Pixastic.Actions[n]&&typeof Pixastic.Actions[n].process=="function"){y=true}if(!y){if(Pixastic.debug)s('Invalid action "'+n+'". Maybe file not included?');return false}if(!Pixastic.Actions[n].checkSupport()){if(Pixastic.debug)s('Action "'+n+'" not supported by this browser.');return false}if(Pixastic.Client.hasCanvas()){if(o!==e){o.width=f;o.height=l}if(!a){o.style.width=f+"px";o.style.height=l+"px"}u.drawImage(t,0,0,f,l);if(!e.__pixastic_org_image){o.__pixastic_org_image=e;o.__pixastic_org_width=f;o.__pixastic_org_height=l}else{o.__pixastic_org_image=e.__pixastic_org_image;o.__pixastic_org_width=e.__pixastic_org_width;o.__pixastic_org_height=e.__pixastic_org_height}}else if(Pixastic.Client.isIE()&&typeof e.__pixastic_org_style=="undefined"){e.__pixastic_org_style=e.style.cssText}var b={image:e,canvas:o,width:f,height:l,useData:true,options:r};var w=Pixastic.Actions[n].process(b);if(!w){return false}if(Pixastic.Client.hasCanvas()){if(b.useData){if(Pixastic.Client.hasCanvasImageData()){o.getContext("2d").putImageData(b.canvasData,r.rect.left,r.rect.top);o.getContext("2d").fillRect(0,0,0,0)}}if(!r.leaveDOM){o.title=e.title;o.imgsrc=e.imgsrc;if(!i)o.alt=e.alt;if(!i)o.imgsrc=e.src;o.className=e.className;o.style.cssText=e.style.cssText;o.name=e.name;o.tabIndex=e.tabIndex;o.id=e.id;if(e.parentNode&&e.parentNode.replaceChild){e.parentNode.replaceChild(o,e)}}r.resultCanvas=o;return o}return e},prepareData:function(e,t){var n=e.canvas.getContext("2d");var r=e.options.rect;var i=n.getImageData(r.left,r.top,r.width,r.height);var s=i.data;if(!t)e.canvasData=i;return s},process:function(e,t,n,r){if(e.tagName.toLowerCase()=="img"){var i=new Image;i.src=e.src;if(i.complete){var s=Pixastic.applyAction(e,i,t,n);if(r)r(s);return s}else{i.onload=function(){var s=Pixastic.applyAction(e,i,t,n);if(r)r(s)}}}if(e.tagName.toLowerCase()=="canvas"){var s=Pixastic.applyAction(e,e,t,n);if(r)r(s);return s}},revert:function(e){if(Pixastic.Client.hasCanvas()){if(e.tagName.toLowerCase()=="canvas"&&e.__pixastic_org_image){e.width=e.__pixastic_org_width;e.height=e.__pixastic_org_height;e.getContext("2d").drawImage(e.__pixastic_org_image,0,0);if(e.parentNode&&e.parentNode.replaceChild){e.parentNode.replaceChild(e.__pixastic_org_image,e)}return e}}else if(Pixastic.Client.isIE()){if(typeof e.__pixastic_org_style!="undefined")e.style.cssText=e.__pixastic_org_style}},Client:{hasCanvas:o,hasCanvasImageData:u,hasGlobalAlpha:a,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();Pixastic.Actions.blend={process:function(e){var t=parseFloat(e.options.amount);var n=(e.options.mode||"normal").toLowerCase();var r=e.options.image;t=Math.max(0,Math.min(1,t));if(!r)return false;if(Pixastic.Client.hasCanvasImageData()){var i=e.options.rect;var s=Pixastic.prepareData(e);var o=i.width;var u=i.height;e.useData=false;var a=document.createElement("canvas");a.width=e.canvas.width;a.height=e.canvas.height;var f=a.getContext("2d");f.drawImage(r,0,0);var l={canvas:a,options:e.options};var c=Pixastic.prepareData(l);var h=l.canvasData;var p=o*u;var d=p*4;var v,m;var g,y,b;var w,E,S;var x,T,N;var C,k,L;var A=false;switch(n){case"normal":break;case"multiply":while(p--){c[d-=4]=s[d]*c[d]/255;c[v=d+1]=s[v]*c[v]/255;c[m=d+2]=s[m]*c[m]/255}A=true;break;case"lighten":while(p--){if((g=s[d-=4])>c[d])c[d]=g;if((y=s[v=d+1])>c[v])c[v]=y;if((b=s[m=d+2])>c[m])c[m]=b}A=true;break;case"darken":while(p--){if((g=s[d-=4])<c[d])c[d]=g;if((y=s[v=d+1])<c[v])c[v]=y;if((b=s[m=d+2])<c[m])c[m]=b}A=true;break;case"darkercolor":while(p--){if((g=s[d-=4])*.3+(y=s[v=d+1])*.59+(b=s[m=d+2])*.11<=c[d]*.3+c[v]*.59+c[m]*.11){c[d]=g;c[v]=y;c[m]=b}}A=true;break;case"lightercolor":while(p--){if((g=s[d-=4])*.3+(y=s[v=d+1])*.59+(b=s[m=d+2])*.11>c[d]*.3+c[v]*.59+c[m]*.11){c[d]=g;c[v]=y;c[m]=b}}A=true;break;case"lineardodge":while(p--){if((x=s[d-=4]+c[d])>255)c[d]=255;else c[d]=x;if((T=s[v=d+1]+c[v])>255)c[v]=255;else c[v]=T;if((N=s[m=d+2]+c[m])>255)c[m]=255;else c[m]=N}A=true;break;case"linearburn":while(p--){if((x=s[d-=4]+c[d])<255)c[d]=0;else c[d]=x-255;if((T=s[v=d+1]+c[v])<255)c[v]=0;else c[v]=T-255;if((N=s[m=d+2]+c[m])<255)c[m]=0;else c[m]=N-255}A=true;break;case"difference":while(p--){if((x=s[d-=4]-c[d])<0)c[d]=-x;else c[d]=x;if((T=s[v=d+1]-c[v])<0)c[v]=-T;else c[v]=T;if((N=s[m=d+2]-c[m])<0)c[m]=-N;else c[m]=N}A=true;break;case"screen":while(p--){c[d-=4]=255-((255-c[d])*(255-s[d])>>8);c[v=d+1]=255-((255-c[v])*(255-s[v])>>8);c[m=d+2]=255-((255-c[m])*(255-s[m])>>8)}A=true;break;case"exclusion":var O=2/255;while(p--){c[d-=4]=(g=s[d])-(g*O-1)*c[d];c[v=d+1]=(y=s[v])-(y*O-1)*c[v];c[m=d+2]=(b=s[m])-(b*O-1)*c[m]}A=true;break;case"overlay":var O=2/255;while(p--){if((g=s[d-=4])<128)c[d]=c[d]*g*O;else c[d]=255-(255-c[d])*(255-g)*O;if((y=s[v=d+1])<128)c[v]=c[v]*y*O;else c[v]=255-(255-c[v])*(255-y)*O;if((b=s[m=d+2])<128)c[m]=c[m]*b*O;else c[m]=255-(255-c[m])*(255-b)*O}A=true;break;case"softlight":var O=2/255;while(p--){if((g=s[d-=4])<128)c[d]=((c[d]>>1)+64)*g*O;else c[d]=255-(191-(c[d]>>1))*(255-g)*O;if((y=s[v=d+1])<128)c[v]=((c[v]>>1)+64)*y*O;else c[v]=255-(191-(c[v]>>1))*(255-y)*O;if((b=s[m=d+2])<128)c[m]=((c[m]>>1)+64)*b*O;else c[m]=255-(191-(c[m]>>1))*(255-b)*O}A=true;break;case"hardlight":var O=2/255;while(p--){if((w=c[d-=4])<128)c[d]=s[d]*w*O;else c[d]=255-(255-s[d])*(255-w)*O;if((E=c[v=d+1])<128)c[v]=s[v]*E*O;else c[v]=255-(255-s[v])*(255-E)*O;if((S=c[m=d+2])<128)c[m]=s[m]*S*O;else c[m]=255-(255-s[m])*(255-S)*O}A=true;break;case"colordodge":while(p--){if((x=(s[d-=4]<<8)/(255-(w=c[d])))>255||w==255)c[d]=255;else c[d]=x;if((T=(s[v=d+1]<<8)/(255-(E=c[v])))>255||E==255)c[v]=255;else c[v]=T;if((N=(s[m=d+2]<<8)/(255-(S=c[m])))>255||S==255)c[m]=255;else c[m]=N}A=true;break;case"colorburn":while(p--){if((x=255-(255-s[d-=4]<<8)/c[d])<0||c[d]==0)c[d]=0;else c[d]=x;if((T=255-(255-s[v=d+1]<<8)/c[v])<0||c[v]==0)c[v]=0;else c[v]=T;if((N=255-(255-s[m=d+2]<<8)/c[m])<0||c[m]==0)c[m]=0;else c[m]=N}A=true;break;case"linearlight":while(p--){if((x=2*(w=c[d-=4])+s[d]-256)<0||w<128&&x<0){c[d]=0}else{if(x>255)c[d]=255;else c[d]=x}if((T=2*(E=c[v=d+1])+s[v]-256)<0||E<128&&T<0){c[v]=0}else{if(T>255)c[v]=255;else c[v]=T}if((N=2*(S=c[m=d+2])+s[m]-256)<0||S<128&&N<0){c[m]=0}else{if(N>255)c[m]=255;else c[m]=N}}A=true;break;case"vividlight":while(p--){if((w=c[d-=4])<128){if(w){if((x=255-(255-s[d]<<8)/(2*w))<0)c[d]=0;else c[d]=x}else{c[d]=0}}else if((x=C=2*w-256)<255){if((x=(s[d]<<8)/(255-C))>255)c[d]=255;else c[d]=x}else{if(x<0)c[d]=0;else c[d]=x}if((E=c[v=d+1])<128){if(E){if((T=255-(255-s[v]<<8)/(2*E))<0)c[v]=0;else c[v]=T}else{c[v]=0}}else if((T=k=2*E-256)<255){if((T=(s[v]<<8)/(255-k))>255)c[v]=255;else c[v]=T}else{if(T<0)c[v]=0;else c[v]=T}if((S=c[m=d+2])<128){if(S){if((N=255-(255-s[m]<<8)/(2*S))<0)c[m]=0;else c[m]=N}else{c[m]=0}}else if((N=L=2*S-256)<255){if((N=(s[m]<<8)/(255-L))>255)c[m]=255;else c[m]=N}else{if(N<0)c[m]=0;else c[m]=N}}A=true;break;case"pinlight":while(p--){if((w=c[d-=4])<128)if((g=s[d])<(C=2*w))c[d]=g;else c[d]=C;else if((g=s[d])>(C=2*w-256))c[d]=g;else c[d]=C;if((E=c[v=d+1])<128)if((y=s[v])<(k=2*E))c[v]=y;else c[v]=k;else if((y=s[v])>(k=2*E-256))c[v]=y;else c[v]=k;if((w=c[m=d+2])<128)if((g=s[m])<(C=2*w))c[m]=g;else c[m]=C;else if((g=s[m])>(C=2*w-256))c[m]=g;else c[m]=C}A=true;break;case"hardmix":while(p--){if((w=c[d-=4])<128)if(255-(255-s[d]<<8)/(2*w)<128||w==0)c[d]=0;else c[d]=255;else if((C=2*w-256)<255&&(s[d]<<8)/(255-C)<128)c[d]=0;else c[d]=255;if((E=c[v=d+1])<128)if(255-(255-s[v]<<8)/(2*E)<128||E==0)c[v]=0;else c[v]=255;else if((k=2*E-256)<255&&(s[v]<<8)/(255-k)<128)c[v]=0;else c[v]=255;if((S=c[m=d+2])<128)if(255-(255-s[m]<<8)/(2*S)<128||S==0)c[m]=0;else c[m]=255;else if((L=2*S-256)<255&&(s[m]<<8)/(255-L)<128)c[m]=0;else c[m]=255}A=true;break}if(A)f.putImageData(h,0,0);if(t!=1&&!Pixastic.Client.hasGlobalAlpha()){var p=o*u;var M=t;var _=1-t;while(p--){var d=p*4;var D=s[d]*_+c[d]*M>>0;var P=s[d+1]*_+c[d+1]*M>>0;var H=s[d+2]*_+c[d+2]*M>>0;s[d]=D;s[d+1]=P;s[d+2]=H}e.useData=true}else{var B=e.canvas.getContext("2d");B.save();B.globalAlpha=t;B.drawImage(a,0,0,i.width,i.height,i.left,i.top,i.width,i.height);B.globalAlpha=1;B.restore()}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.blur={process:function(e){if(typeof e.options.fixMargin=="undefined")e.options.fixMargin=true;if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(e);var n=Pixastic.prepareData(e,true);var r=[[0,1,0],[1,2,1],[0,1,0]];var i=0;for(var s=0;s<3;s++){for(var o=0;o<3;o++){i+=r[s][o]}}i=1/(i*2);var u=e.options.rect;var a=u.width;var f=u.height;var l=a*4;var c=f;do{var h=(c-1)*l;var p=c==1?0:c-2;var d=c==f?c-1:c;var v=p*a*4;var m=d*a*4;var g=a;do{var y=h+(g*4-4);var b=v+(g==1?0:g-2)*4;var w=m+(g==a?g-1:g)*4;t[y]=((n[b]+n[y-4]+n[y+4]+n[w])*2+n[y]*4)*i;t[y+1]=((n[b+1]+n[y-3]+n[y+5]+n[w+1])*2+n[y+1]*4)*i;t[y+2]=((n[b+2]+n[y-2]+n[y+6]+n[w+2])*2+n[y+2]*4)*i}while(--g)}while(--c);return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)";if(e.options.fixMargin){e.image.style.marginLeft=(parseInt(e.image.style.marginLeft,10)||0)-2+"px";e.image.style.marginTop=(parseInt(e.image.style.marginTop,10)||0)-2+"px"}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.blurfast={process:function(e){var t=parseFloat(e.options.amount)||0;var n=!!(e.options.clear&&e.options.clear!="false");t=Math.max(0,Math.min(5,t));if(Pixastic.Client.hasCanvas()){var r=e.options.rect;var i=e.canvas.getContext("2d");i.save();i.beginPath();i.rect(r.left,r.top,r.width,r.height);i.clip();var s=2;var o=Math.round(e.width/s);var u=Math.round(e.height/s);var a=document.createElement("canvas");a.width=o;a.height=u;var n=false;var f=Math.round(t*20);var l=a.getContext("2d");for(var c=0;c<f;c++){var h=Math.max(1,Math.round(o-c));var p=Math.max(1,Math.round(u-c));l.clearRect(0,0,o,u);l.drawImage(e.canvas,0,0,e.width,e.height,0,0,h,p);if(n)i.clearRect(r.left,r.top,r.width,r.height);i.drawImage(a,0,0,h,p,0,0,e.width,e.height)}i.restore();e.useData=false;return true}else if(Pixastic.Client.isIE()){var d=10*t;e.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+d+")";if(e.options.fixMargin||1){e.image.style.marginLeft=(parseInt(e.image.style.marginLeft,10)||0)-Math.round(d)+"px";e.image.style.marginTop=(parseInt(e.image.style.marginTop,10)||0)-Math.round(d)+"px"}return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.brightness={process:function(e){var t=parseInt(e.options.brightness,10)||0;var n=parseFloat(e.options.contrast)||0;var r=!!(e.options.legacy&&e.options.legacy!="false");if(r){t=Math.min(150,Math.max(-150,t))}else{var i=1+Math.min(150,Math.max(-150,t))/150}n=Math.max(0,n+1);if(Pixastic.Client.hasCanvasImageData()){var s=Pixastic.prepareData(e);var o=e.options.rect;var u=o.width;var a=o.height;var f=u*a;var l=f*4,c,h;var p,d;if(n!=1){if(r){p=n;d=(t-128)*n+128}else{p=i*n;d=-n*128+128}}else{if(r){p=1;d=t}else{p=i;d=0}}var v,m,g;while(f--){if((v=s[l-=4]*p+d)>255)s[l]=255;else if(v<0)s[l]=0;else s[l]=v;if((m=s[c=l+1]*p+d)>255)s[c]=255;else if(m<0)s[c]=0;else s[c]=m;if((g=s[h=l+2]*p+d)>255)s[h]=255;else if(g<0)s[h]=0;else s[h]=g}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.coloradjust={process:function(e){var t=parseFloat(e.options.red)||0;var n=parseFloat(e.options.green)||0;var r=parseFloat(e.options.blue)||0;t=Math.round(t*255);n=Math.round(n*255);r=Math.round(r*255);if(Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(e);var s=e.options.rect;var o=s.width*s.height;var u=o*4,a,f;var l,c,h;while(o--){u-=4;if(t){if((l=i[u]+t)<0)i[u]=0;else if(l>255)i[u]=255;else i[u]=l}if(n){if((c=i[a=u+1]+n)<0)i[a]=0;else if(c>255)i[a]=255;else i[a]=c}if(r){if((h=i[f=u+2]+r)<0)i[f]=0;else if(h>255)i[f]=255;else i[f]=h}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.colorhistogram={array256:function(e){var t=[];for(var n=0;n<256;n++){t[n]=e}return t},process:function(e){var t=[];if(typeof e.options.returnValue!="object"){e.options.returnValue={rvals:[],gvals:[],bvals:[]}}var n=!!e.options.paint;var r=e.options.returnValue;if(typeof r.values!="array"){r.rvals=[];r.gvals=[];r.bvals=[]}if(Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(e);e.useData=false;var s=this.array256(0);var o=this.array256(0);var u=this.array256(0);var a=e.options.rect;var f=a.width*a.height;var l=f*4;while(f--){s[i[l-=4]]++;o[i[l+1]]++;u[i[l+2]]++}r.rvals=s;r.gvals=o;r.bvals=u;if(n){var c=e.canvas.getContext("2d");var h=[s,o,u];for(var p=0;p<3;p++){var d=(p+1)*e.height/3;var v=0;for(var m=0;m<256;m++){if(h[p][m]>v)v=h[p][m]}var g=e.height/3/v;var y=e.width/256;if(p==0)c.fillStyle="rgba(255,0,0,0.5)";else if(p==1)c.fillStyle="rgba(0,255,0,0.5)";else if(p==2)c.fillStyle="rgba(0,0,255,0.5)";for(var m=0;m<256;m++){c.fillRect(m*y,e.height-g*h[p][m]-e.height+d,y,h[p][m]*g)}}}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.crop={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect;var n=t.width;var r=t.height;var i=t.top;var s=t.left;if(typeof e.options.left!="undefined")s=parseInt(e.options.left,10);if(typeof e.options.top!="undefined")i=parseInt(e.options.top,10);if(typeof e.options.height!="undefined")n=parseInt(e.options.width,10);if(typeof e.options.height!="undefined")r=parseInt(e.options.height,10);if(s<0)s=0;if(s>e.width-1)s=e.width-1;if(i<0)i=0;if(i>e.height-1)i=e.height-1;if(n<1)n=1;if(s+n>e.width)n=e.width-s;if(r<1)r=1;if(i+r>e.height)r=e.height-i;var o=document.createElement("canvas");o.width=e.width;o.height=e.height;o.getContext("2d").drawImage(e.canvas,0,0);e.canvas.width=n;e.canvas.height=r;e.canvas.getContext("2d").clearRect(0,0,n,r);e.canvas.getContext("2d").drawImage(o,s,i,n,r,0,0,n,r);e.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.desaturate={process:function(e){var t=!!(e.options.average&&e.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);var r=e.options.rect;var i=r.width;var s=r.height;var o=i*s;var u=o*4,a,f;if(t){while(o--)n[u-=4]=n[a=u+1]=n[f=u+2]=(n[u]+n[a]+n[f])/3}else{while(o--)n[u-=4]=n[a=u+1]=n[f=u+2]=n[u]*.3+n[a]*.59+n[f]*.11}return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" gray";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.edges={process:function(e){var t=!!(e.options.mono&&e.options.mono!="false");var n=!!(e.options.invert&&e.options.invert!="false");if(Pixastic.Client.hasCanvasImageData()){var r=Pixastic.prepareData(e);var i=Pixastic.prepareData(e,true);var s=-1/8;var o=[[s,s,s],[s,1,s],[s,s,s]];var u=1/s;var a=e.options.rect;var f=a.width;var l=a.height;var c=f*4;var h=l;do{var p=(h-1)*c;var d=h==l?h-1:h;var v=h==1?0:h-2;var m=v*f*4;var g=d*f*4;var y=f;do{var b=p+(y*4-4);var w=m+(y==1?0:y-2)*4;var E=g+(y==f?y-1:y)*4;var S=((i[w-4]+i[w]+i[w+4]+i[b-4]+i[b+4]+i[E-4]+i[E]+i[E+4])*s+i[b])*u;var x=((i[w-3]+i[w+1]+i[w+5]+i[b-3]+i[b+5]+i[E-3]+i[E+1]+i[E+5])*s+i[b+1])*u;var T=((i[w-2]+i[w+2]+i[w+6]+i[b-2]+i[b+6]+i[E-2]+i[E+2]+i[E+6])*s+i[b+2])*u;if(t){var N=S*.3+x*.59+T*.11||0;if(n)N=255-N;if(N<0)N=0;if(N>255)N=255;S=x=T=N}else{if(n){S=255-S;x=255-x;T=255-T}if(S<0)S=0;if(x<0)x=0;if(T<0)T=0;if(S>255)S=255;if(x>255)x=255;if(T>255)T=255}r[b]=S;r[b+1]=x;r[b+2]=T}while(--y)}while(--h);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.edges2={process:function(e){if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(e);var n=Pixastic.prepareData(e,true);var r=e.options.rect;var i=r.width;var s=r.height;var o=i*4;var u=o+4;var a=s-1;var f=i-1;for(var l=1;l<a;++l){var c=u-4;var h=c-o;var p=c+o;var d=-n[h]-n[c]-n[p];var v=-n[++h]-n[++c]-n[++p];var m=-n[++h]-n[++c]-n[++p];var g=n[h+=2];var y=n[++h];var b=n[++h];var w=n[c+=2];var E=n[++c];var S=n[++c];var x=n[p+=2];var T=n[++p];var N=n[++p];var C=-g-w-x;var k=-y-E-T;var L=-b-S-N;for(var A=1;A<f;++A){c=u+4;h=c-o;p=c+o;var O=127+d-g-w*-8-x;var M=127+v-y-E*-8-T;var _=127+m-b-S*-8-N;d=C;v=k;m=L;g=n[h];y=n[++h];b=n[++h];w=n[c];E=n[++c];S=n[++c];x=n[p];T=n[++p];N=n[++p];O+=C=-g-w-x;M+=k=-y-E-T;_+=L=-b-S-N;if(O>255)O=255;if(M>255)M=255;if(_>255)_=255;if(O<0)O=0;if(M<0)M=0;if(_<0)_=0;t[u]=O;t[++u]=M;t[++u]=_;u+=2}u+=8}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.emboss={process:function(e){var t=parseFloat(e.options.strength)||1;var n=typeof e.options.greyLevel!="undefined"?parseInt(e.options.greyLevel):180;var r=e.options.direction||"topleft";var i=!!(e.options.blend&&e.options.blend!="false");var s=0;var o=0;switch(r){case"topleft":s=-1;o=-1;break;case"top":s=-1;o=0;break;case"topright":s=-1;o=1;break;case"right":s=0;o=1;break;case"bottomright":s=1;o=1;break;case"bottom":s=1;o=0;break;case"bottomleft":s=1;o=-1;break;case"left":s=0;o=-1;break}if(Pixastic.Client.hasCanvasImageData()){var u=Pixastic.prepareData(e);var a=Pixastic.prepareData(e,true);var f=!!e.options.invertAlpha;var l=e.options.rect;var c=l.width;var h=l.height;var p=c*4;var d=h;do{var v=(d-1)*p;var m=s;if(d+m<1)m=0;if(d+m>h)m=0;var g=(d-1+m)*c*4;var y=c;do{var b=v+(y-1)*4;var w=o;if(y+w<1)w=0;if(y+w>c)w=0;var E=g+(y-1+w)*4;var S=a[b]-a[E];var x=a[b+1]-a[E+1];var T=a[b+2]-a[E+2];var N=S;var C=N>0?N:-N;var k=x>0?x:-x;var L=T>0?T:-T;if(k>C){N=x}if(L>C){N=T}N*=t;if(i){var A=u[b]+N;var O=u[b+1]+N;var M=u[b+2]+N;u[b]=A>255?255:A<0?0:A;u[b+1]=O>255?255:O<0?0:O;u[b+2]=M>255?255:M<0?0:M}else{var _=n-N;if(_<0){_=0}else if(_>255){_=255}u[b]=u[b+1]=u[b+2]=_}}while(--y)}while(--d);return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" progid:DXImageTransform.Microsoft.emboss()";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.flip={process:function(e){var t=e.options.rect;var n=document.createElement("canvas");n.width=t.width;n.height=t.height;n.getContext("2d").drawImage(e.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height);var r=e.canvas.getContext("2d");r.clearRect(t.left,t.top,t.width,t.height);if(e.options.axis=="horizontal"){r.scale(-1,1);r.drawImage(n,-t.left-t.width,t.top,t.width,t.height)}else{r.scale(1,-1);r.drawImage(n,t.left,-t.top-t.height,t.width,t.height)}e.useData=false;return true},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.fliph={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect;var n=document.createElement("canvas");n.width=t.width;n.height=t.height;n.getContext("2d").drawImage(e.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height);var r=e.canvas.getContext("2d");r.clearRect(t.left,t.top,t.width,t.height);r.scale(-1,1);r.drawImage(n,-t.left-t.width,t.top,t.width,t.height);e.useData=false;return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" fliph";return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.flipv={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.options.rect;var n=document.createElement("canvas");n.width=t.width;n.height=t.height;n.getContext("2d").drawImage(e.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height);var r=e.canvas.getContext("2d");r.clearRect(t.left,t.top,t.width,t.height);r.scale(1,-1);r.drawImage(n,t.left,-t.top-t.height,t.width,t.height);e.useData=false;return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" flipv";return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.glow={process:function(e){var t=parseFloat(e.options.amount)||0;var n=parseFloat(e.options.radius)||0;t=Math.min(1,Math.max(0,t));n=Math.min(5,Math.max(0,n));if(Pixastic.Client.hasCanvasImageData()){var r=e.options.rect;var i=document.createElement("canvas");i.width=e.width;i.height=e.height;var s=i.getContext("2d");s.drawImage(e.canvas,0,0);var o=2;var u=Math.round(e.width/o);var a=Math.round(e.height/o);var f=document.createElement("canvas");f.width=u;f.height=a;var l=true;var c=Math.round(n*20);var h=f.getContext("2d");for(var p=0;p<c;p++){var d=Math.max(1,Math.round(u-p));var v=Math.max(1,Math.round(a-p));h.clearRect(0,0,u,a);h.drawImage(i,0,0,e.width,e.height,0,0,d,v);s.clearRect(0,0,e.width,e.height);s.drawImage(f,0,0,d,v,0,0,e.width,e.height)}var m=Pixastic.prepareData(e);var g=Pixastic.prepareData({canvas:i,options:e.options});var y=r.width*r.height;var b=y*4,w=b+1,E=b+2,S=b+3;while(y--){if((m[b-=4]+=t*g[b])>255)m[b]=255;if((m[w-=4]+=t*g[w])>255)m[w]=255;if((m[E-=4]+=t*g[E])>255)m[E]=255}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.histogram={process:function(e){var t=!!(e.options.average&&e.options.average!="false");var n=!!(e.options.paint&&e.options.paint!="false");var r=e.options.color||"rgba(255,255,255,0.5)";var i=[];if(typeof e.options.returnValue!="object"){e.options.returnValue={values:[]}}var s=e.options.returnValue;if(typeof s.values!="array"){s.values=[]}i=s.values;if(Pixastic.Client.hasCanvasImageData()){var o=Pixastic.prepareData(e);e.useData=false;for(var u=0;u<256;u++){i[u]=0}var a=e.options.rect;var f=a.width*a.height;var l=f*4,c=l+1,h=l+2,p=l+3;var d=Math.round;if(t){while(f--){i[d((o[l-=4]+o[l+1]+o[l+2])/3)]++}}else{while(f--){i[d(o[l-=4]*.3+o[l+1]*.59+o[l+2]*.11)]++}}if(n){var v=0;for(var u=0;u<256;u++){if(i[u]>v){v=i[u]}}var m=e.height/v;var g=e.width/256;var y=e.canvas.getContext("2d");y.fillStyle=r;for(var u=0;u<256;u++){y.fillRect(u*g,e.height-m*i[u],g,i[u]*m)}}s.values=i;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.hsl={process:function(e){var t=parseInt(e.options.hue,10)||0;var n=(parseInt(e.options.saturation,10)||0)/100;var r=(parseInt(e.options.lightness,10)||0)/100;if(n<0){var i=1+n}else{var i=1+n*2}t=t%360/360;var s=t*6;var o=1/255;var u=r*255;var a=1+r;var f=1-r;if(Pixastic.Client.hasCanvasImageData()){var l=Pixastic.prepareData(e);var c=e.options.rect;var h=c.width*c.height;var p=h*4,d=p+1,v=p+2,m=p+3;while(h--){var g=l[p-=4];var y=l[d=p+1];var b=l[v=p+2];if(t!=0||n!=0){var w=g;if(y>w)w=y;if(b>w)w=b;var E=g;if(y<E)E=y;if(b<E)E=b;var S=w-E;var x=(E+w)/510;if(x>0){if(S>0){if(x<=.5){var T=S/(w+E)*i;if(T>1)T=1;var N=x*(1+T)}else{var T=S/(510-w-E)*i;if(T>1)T=1;var N=x+T-x*T}if(g==w){if(y==E)var C=5+(w-b)/S+s;else var C=1-(w-y)/S+s}else if(y==w){if(b==E)var C=1+(w-g)/S+s;else var C=3-(w-b)/S+s}else{if(g==E)var C=3+(w-y)/S+s;else var C=5-(w-g)/S+s}if(C<0)C+=6;if(C>=6)C-=6;var k=x+x-N;var L=C>>0;if(L==0){g=N*255;y=(k+(N-k)*(C-L))*255;b=k*255}else if(L==1){g=(N-(N-k)*(C-L))*255;y=N*255;b=k*255}else if(L==2){g=k*255;y=N*255;b=(k+(N-k)*(C-L))*255}else if(L==3){g=k*255;y=(N-(N-k)*(C-L))*255;b=N*255}else if(L==4){g=(k+(N-k)*(C-L))*255;y=k*255;b=N*255}else if(L==5){g=N*255;y=k*255;b=(N-(N-k)*(C-L))*255}}}}if(r<0){g*=a;y*=a;b*=a}else if(r>0){g=g*f+u;y=y*f+u;b=b*f+u}if(g<0)l[p]=0;else if(g>255)l[p]=255;else l[p]=g;if(y<0)l[d]=0;else if(y>255)l[d]=255;else l[d]=y;if(b<0)l[v]=0;else if(b>255)l[v]=255;else l[v]=b}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.invert={process:function(e){if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(e);var n=!!e.options.invertAlpha;var r=e.options.rect;var i=r.width*r.height;var s=i*4,o=s+1,u=s+2,a=s+3;while(i--){t[s-=4]=255-t[s];t[o-=4]=255-t[o];t[u-=4]=255-t[u];if(n)t[a-=4]=255-t[a]}return true}else if(Pixastic.Client.isIE()){e.image.style.filter+=" invert";return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.laplace={process:function(e){var t=1;var n=!!(e.options.invert&&e.options.invert!="false");var r=parseFloat(e.options.edgeStrength)||0;var i=parseInt(e.options.greyLevel)||0;r=-r;if(Pixastic.Client.hasCanvasImageData()){var s=Pixastic.prepareData(e);var o=Pixastic.prepareData(e,true);var u=[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]];var a=1/8;var f=e.options.rect;var l=f.width;var c=f.height;var h=l*4;var p=c;do{var d=(p-1)*h;var v=p==c?p-1:p;var m=p==1?0:p-2;var g=m*l*4;var y=v*l*4;var b=l;do{var w=d+(b*4-4);var E=g+(b==1?0:b-2)*4;var S=y+(b==l?b-1:b)*4;var x=(-o[E-4]-o[E]-o[E+4]-o[w-4]-o[w+4]-o[S-4]-o[S]-o[S+4]+o[w]*8)*a;var T=(-o[E-3]-o[E+1]-o[E+5]-o[w-3]-o[w+5]-o[S-3]-o[S+1]-o[S+5]+o[w+1]*8)*a;var N=(-o[E-2]-o[E+2]-o[E+6]-o[w-2]-o[w+6]-o[S-2]-o[S+2]-o[S+6]+o[w+2]*8)*a;var C=(x+T+N)/3+i;if(r!=0){if(C>127){C+=(C+1-128)*r}else if(C<127){C-=(C+1)*r}}if(n){C=255-C}if(C<0)C=0;if(C>255)C=255;s[w]=s[w+1]=s[w+2]=C}while(--b)}while(--p);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.lighten={process:function(e){var t=parseFloat(e.options.amount)||0;t=Math.max(-1,Math.min(1,t));if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);var r=e.options.rect;var i=r.width*r.height;var s=i*4,o=s+1,u=s+2;var a=t+1;while(i--){if((n[s-=4]=n[s]*a)>255)n[s]=255;if((n[o-=4]=n[o]*a)>255)n[o]=255;if((n[u-=4]=n[u]*a)>255)n[u]=255}return true}else if(Pixastic.Client.isIE()){var f=e.image;if(t<0){f.style.filter+=" light()";f.filters[f.filters.length-1].addAmbient(255,255,255,100*-t)}else if(t>0){f.style.filter+=" light()";f.filters[f.filters.length-1].addAmbient(255,255,255,100);f.filters[f.filters.length-1].addAmbient(255,255,255,100*t)}return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.mosaic={process:function(e){var t=Math.max(1,parseInt(e.options.blockSize,10));if(Pixastic.Client.hasCanvasImageData()){var n=e.options.rect;var r=n.width;var i=n.height;var s=r*4;var o=i;var u=e.canvas.getContext("2d");var a=document.createElement("canvas");a.width=a.height=1;var f=a.getContext("2d");var l=document.createElement("canvas");l.width=r;l.height=i;var c=l.getContext("2d");c.drawImage(e.canvas,n.left,n.top,r,i,0,0,r,i);for(var o=0;o<i;o+=t){for(var h=0;h<r;h+=t){var p=t;var d=t;if(p+h>r)p=r-h;if(d+o>i)d=i-o;f.drawImage(l,h,o,p,d,0,0,1,1);var v=f.getImageData(0,0,1,1).data;u.fillStyle="rgb("+v[0]+","+v[1]+","+v[2]+")";u.fillRect(n.left+h,n.top+o,t,t)}}e.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.noise={process:function(e){var t=0;var n=0;var r=false;if(typeof e.options.amount!="undefined")t=parseFloat(e.options.amount)||0;if(typeof e.options.strength!="undefined")n=parseFloat(e.options.strength)||0;if(typeof e.options.mono!="undefined")r=!!(e.options.mono&&e.options.mono!="false");t=Math.max(0,Math.min(1,t));n=Math.max(0,Math.min(1,n));var i=128*n;var s=i/2;if(Pixastic.Client.hasCanvasImageData()){var o=Pixastic.prepareData(e);var u=e.options.rect;var a=u.width;var f=u.height;var l=a*4;var c=f;var h=Math.random;do{var p=(c-1)*l;var d=a;do{var v=p+(d-1)*4;if(h()<t){if(r){var m=-s+h()*i;var g=o[v]+m;var y=o[v+1]+m;var b=o[v+2]+m}else{var g=o[v]-s+h()*i;var y=o[v+1]-s+h()*i;var b=o[v+2]-s+h()*i}if(g<0)g=0;if(y<0)y=0;if(b<0)b=0;if(g>255)g=255;if(y>255)y=255;if(b>255)b=255;o[v]=g;o[v+1]=y;o[v+2]=b}}while(--d)}while(--c);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.posterize={process:function(e){var t=256;if(typeof e.options.levels!="undefined")t=parseInt(e.options.levels,10)||1;if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);t=Math.max(2,Math.min(256,t));var r=256/t;var i=256/(t-1);var s=e.options.rect;var o=s.width;var u=s.height;var a=o*4;var f=u;do{var l=(f-1)*a;var c=o;do{var h=l+(c-1)*4;var p=i*(n[h]/r>>0);var d=i*(n[h+1]/r>>0);var v=i*(n[h+2]/r>>0);if(p>255)p=255;if(d>255)d=255;if(v>255)v=255;n[h]=p;n[h+1]=d;n[h+2]=v}while(--c)}while(--f);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.pointillize={process:function(e){var t=Math.max(1,parseInt(e.options.radius,10));var n=Math.min(5,Math.max(0,parseFloat(e.options.density)||0));var r=Math.max(0,parseFloat(e.options.noise)||0);var i=!!(e.options.transparent&&e.options.transparent!="false");if(Pixastic.Client.hasCanvasImageData()){var s=e.options.rect;var o=s.width;var u=s.height;var a=o*4;var f=u;var l=e.canvas.getContext("2d");var c=e.canvas.width;var h=e.canvas.height;var p=document.createElement("canvas");p.width=p.height=1;var d=p.getContext("2d");var v=document.createElement("canvas");v.width=o;v.height=u;var m=v.getContext("2d");m.drawImage(e.canvas,s.left,s.top,o,u,0,0,o,u);var g=t*2;if(i)l.clearRect(s.left,s.top,s.width,s.height);var y=t*r;var b=1/n;for(var f=0;f<u+t;f+=g*b){for(var w=0;w<o+t;w+=g*b){var E=r?w+(Math.random()*2-1)*y>>0:w;var S=r?f+(Math.random()*2-1)*y>>0:f;var x=E-t;var T=S-t;if(x<0)x=0;if(T<0)T=0;var N=E+s.left;var C=S+s.top;if(N<0)N=0;if(N>c)N=c;if(C<0)C=0;if(C>h)C=h;var k=g;var L=g;if(k+x>o)k=o-x;if(L+T>u)L=u-T;if(k<1)k=1;if(L<1)L=1;d.drawImage(v,x,T,k,L,0,0,1,1);var A=d.getImageData(0,0,1,1).data;l.fillStyle="rgb("+A[0]+","+A[1]+","+A[2]+")";l.beginPath();l.arc(N,C,t,0,Math.PI*2,true);l.closePath();l.fill()}}e.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.removenoise={process:function(e){if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(e);var n=e.options.rect;var r=n.width;var i=n.height;var s=r*4;var o=i;do{var u=(o-1)*s;var a=o==i?o-1:o;var f=o==1?0:o-2;var l=f*r*4;var c=a*r*4;var h=r;do{var p=u+(h*4-4);var d=l+(h==1?0:h-2)*4;var v=c+(h==r?h-1:h)*4;var m,g,y,b,w,E;m=g=t[d];var S=t[p-4],x=t[p+4],T=t[v];if(S<m)m=S;if(x<m)m=x;if(T<m)m=T;if(S>g)g=S;if(x>g)g=x;if(T>g)g=T;y=b=t[d+1];var N=t[p-3],C=t[p+5],k=t[v+1];if(N<y)y=N;if(C<y)y=C;if(k<y)y=k;if(N>b)b=N;if(C>b)b=C;if(k>b)b=k;w=E=t[d+2];var L=t[p-2],A=t[p+6],O=t[v+2];if(L<w)w=L;if(A<w)w=A;if(O<w)w=O;if(L>E)E=L;if(A>E)E=A;if(O>E)E=O;if(t[p]>g){t[p]=g}else if(t[p]<m){t[p]=m}if(t[p+1]>b){t[p+1]=b}else if(t[p+1]<y){t[p+1]=y}if(t[p+2]>E){t[p+2]=E}else if(t[p+2]<w){t[p+2]=w}}while(--h)}while(--o);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.resize={process:function(e){if(Pixastic.Client.hasCanvas()){var t=parseInt(e.options.width,10);var n=parseInt(e.options.height,10);var r=e.canvas;if(t<1)t=1;if(t<2)t=2;var i=document.createElement("canvas");i.width=t;i.height=n;i.getContext("2d").drawImage(r,0,0,t,n);r.width=t;r.height=n;r.getContext("2d").drawImage(i,0,0);e.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.rotate={process:function(e){if(Pixastic.Client.hasCanvas()){var t=e.canvas;var n=e.width;var r=e.height;var i=document.createElement("canvas");i.width=n;i.height=r;i.getContext("2d").drawImage(t,0,0,n,r);var s=-parseFloat(e.options.angle)*Math.PI/180;var o=s;if(o>Math.PI*.5)o=Math.PI-o;if(o<-Math.PI*.5)o=-Math.PI-o;var u=Math.sqrt(n*n+r*r);var a=Math.abs(o)-Math.abs(Math.atan2(r,n));var f=Math.abs(o)+Math.abs(Math.atan2(r,n));var l=Math.abs(Math.cos(a)*u);var c=Math.abs(Math.sin(f)*u);t.width=l;t.height=c;var h=t.getContext("2d");h.translate(l/2,c/2);h.rotate(s);h.drawImage(i,-n/2,-r/2);e.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.sepia={process:function(e){var t=parseInt(e.options.mode,10)||0;if(t<0)t=0;if(t>1)t=1;if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);var r=e.options.rect;var i=r.width;var s=r.height;var o=i*4;var u=s;do{var a=(u-1)*o;var f=i;do{var l=a+(f-1)*4;if(t){var c=n[l]*.299+n[l+1]*.587+n[l+2]*.114;var h=c+39;var p=c+14;var d=c-36}else{var v=n[l];var m=n[l+1];var g=n[l+2];var h=v*.393+m*.769+g*.189;var p=v*.349+m*.686+g*.168;var d=v*.272+m*.534+g*.131}if(h<0)h=0;if(h>255)h=255;if(p<0)p=0;if(p>255)p=255;if(d<0)d=0;if(d>255)d=255;n[l]=h;n[l+1]=p;n[l+2]=d}while(--f)}while(--u);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.sharpen={process:function(e){var t=0;if(typeof e.options.amount!="undefined")t=parseFloat(e.options.amount)||0;if(t<0)t=0;if(t>1)t=1;if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);var r=Pixastic.prepareData(e,true);var i=15;var s=1+3*t;var o=[[0,-s,0],[-s,i,-s],[0,-s,0]];var u=0;for(var a=0;a<3;a++){for(var f=0;f<3;f++){u+=o[a][f]}}u=1/u;var l=e.options.rect;var c=l.width;var h=l.height;i*=u;s*=u;var p=c*4;var d=h;do{var v=(d-1)*p;var m=d==h?d-1:d;var g=d==1?0:d-2;var y=g*p;var b=m*p;var w=c;do{var E=v+(w*4-4);var S=y+(w==1?0:w-2)*4;var x=b+(w==c?w-1:w)*4;var T=(-r[S]-r[E-4]-r[E+4]-r[x])*s+r[E]*i;var N=(-r[S+1]-r[E-3]-r[E+5]-r[x+1])*s+r[E+1]*i;var C=(-r[S+2]-r[E-2]-r[E+6]-r[x+2])*s+r[E+2]*i;if(T<0)T=0;if(N<0)N=0;if(C<0)C=0;if(T>255)T=255;if(N>255)N=255;if(C>255)C=255;n[E]=T;n[E+1]=N;n[E+2]=C}while(--w)}while(--d);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.solarize={process:function(e){var t=!!(e.options.average&&e.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var n=Pixastic.prepareData(e);var r=e.options.rect;var i=r.width;var s=r.height;var o=i*4;var u=s;do{var a=(u-1)*o;var f=i;do{var l=a+(f-1)*4;var c=n[l];var h=n[l+1];var p=n[l+2];if(c>127)c=255-c;if(h>127)h=255-h;if(p>127)p=255-p;n[l]=c;n[l+1]=h;n[l+2]=p}while(--f)}while(--u);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.unsharpmask={process:function(e){var t=parseFloat(e.options.amount)||0;var n=parseFloat(e.options.radius)||0;var r=parseFloat(e.options.threshold)||0;t=Math.min(500,Math.max(0,t))/2;n=Math.min(5,Math.max(0,n))/10;r=Math.min(255,Math.max(0,r));r--;var i=-r;t*=.016;t++;if(Pixastic.Client.hasCanvasImageData()){var s=e.options.rect;var o=document.createElement("canvas");o.width=e.width;o.height=e.height;var u=o.getContext("2d");u.drawImage(e.canvas,0,0);var a=2;var f=Math.round(e.width/a);var l=Math.round(e.height/a);var c=document.createElement("canvas");c.width=f;c.height=l;var h=Math.round(n*20);var p=c.getContext("2d");for(var d=0;d<h;d++){var v=Math.max(1,Math.round(f-d));var m=Math.max(1,Math.round(l-d));p.clearRect(0,0,f,l);p.drawImage(o,0,0,e.width,e.height,0,0,v,m);u.clearRect(0,0,e.width,e.height);u.drawImage(c,0,0,v,m,0,0,e.width,e.height)}var g=Pixastic.prepareData(e);var y=Pixastic.prepareData({canvas:o,options:e.options});var b=s.width;var w=s.height;var E=b*4;var S=w;do{var x=(S-1)*E;var T=b;do{var N=x+(T*4-4);var C=g[N]-y[N];if(C>r||C<i){var k=y[N];k=t*C+k;g[N]=k>255?255:k<0?0:k}var L=g[N+1]-y[N+1];if(L>r||L<i){var A=y[N+1];A=t*L+A;g[N+1]=A>255?255:A<0?0:A}var O=g[N+2]-y[N+2];if(O>r||O<i){var M=y[N+2];M=t*O+M;g[N+2]=M>255?255:M<0?0:M}}while(--T)}while(--S);return true}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}}